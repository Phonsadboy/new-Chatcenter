# ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ä‡∏ó
## ChatCenterAI System Review Report

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:** 10 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2567  
**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:** ChatCenterAI-new

---

## ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö](#1-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö)
2. [Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏ô‡∏à‡∏ö](#2-flow-‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏ô‡∏à‡∏ö)
3. [‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° Facebook App](#3-‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà-1-‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°-facebook-app)
4. [‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Facebook Page](#4-‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà-2-‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠-facebook-page-bot)
5. [‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤](#5-‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà-3-‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤-webhook)
6. [‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• AI ‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö](#6-‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà-4-‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•-ai-‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö)
7. [‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤](#7-‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà-5-‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)
8. [‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î](#8-‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î)
9. [‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á](#9-‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á)
10. [‡∏™‡∏£‡∏∏‡∏õ](#10-‡∏™‡∏£‡∏∏‡∏õ)

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         ChatCenterAI System                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Facebook App ‚îÇ    ‚îÇ  Line Bot    ‚îÇ    ‚îÇ  Admin Dashboard     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                   ‚îÇ                       ‚îÇ               ‚îÇ
‚îÇ         ‚ñº                   ‚ñº                       ‚ñº               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                    Webhook Handlers                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ /webhook/fb/:appId (Facebook App Shared)                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ /webhook/facebook/:botId (Legacy per-bot)                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ /webhook/line/:botId                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                             ‚îÇ                                       ‚îÇ
‚îÇ                             ‚ñº                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                     Message Queue                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ addToQueue() - ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ flushQueue() - ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö delay                       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                             ‚îÇ                                       ‚îÇ
‚îÇ                             ‚ñº                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                      AI Processing                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ getAssistantResponseTextOnly()                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ getAssistantResponseMultimodal()                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ OpenAI API (GPT-5, GPT-5-mini, etc.)                      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                             ‚îÇ                                       ‚îÇ
‚îÇ                             ‚ñº                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ                    Response Sender                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ sendFacebookMessage() - ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Facebook                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ sendMessage() - ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Line                           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ

| Component | Technology |
|-----------|------------|
| Backend | Node.js + Express.js |
| Database | MongoDB |
| AI | OpenAI API (GPT-5 series) |
| Real-time | Socket.IO |
| Platforms | Facebook Messenger, Line |
| Frontend | EJS Templates, Bootstrap 5, Vanilla JS |

---

## 2. Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏ô‡∏à‡∏ö

### Sequence Diagram

```mermaid
sequenceDiagram
    participant Admin as ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
    participant Settings as Settings Page
    participant DB as MongoDB
    participant FBDev as Facebook Developer
    participant Webhook as Webhook Handler
    participant Queue as Message Queue
    participant AI as OpenAI API
    participant FBApi as Facebook Graph API
    participant User as ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤

    %% Setup Flow
    Admin->>Settings: 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Facebook App
    Settings->>DB: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å App (appId, verifyToken, webhookUrl)
    Settings-->>Admin: ‡πÅ‡∏™‡∏î‡∏á Webhook URL + Verify Token
    Admin->>FBDev: 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook ‡πÉ‡∏ô Facebook Developer
    FBDev->>Webhook: 3. Verify Webhook (GET)
    Webhook-->>FBDev: Return hub.challenge
    Admin->>Settings: 4. ‡πÄ‡∏û‡∏¥‡πà‡∏° Facebook Page (Bot)
    Settings->>DB: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Page (pageId, accessToken)

    %% Message Flow
    User->>FBApi: 5. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    FBApi->>Webhook: POST /webhook/fb/:appId
    Webhook->>DB: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Bot ‡∏à‡∏≤‡∏Å pageId
    Webhook->>Queue: addToQueue(senderId, message)
    Note over Queue: ‡∏£‡∏≠ delay (default: 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    Queue->>AI: processFlushedMessages()
    AI->>AI: buildSystemInstructions()
    AI->>AI: getAssistantResponse()
    AI-->>Queue: ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö AI
    Queue->>FBApi: sendFacebookMessage()
    FBApi->>User: 6. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
```

---

## 3. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° Facebook App

### 3.1 ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

| ‡πÑ‡∏ü‡∏•‡πå | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà |
|------|--------|
| `views/admin-settings-v2.ejs` | ‡∏´‡∏ô‡πâ‡∏≤ UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Settings |
| `views/partials/modals/facebook-app-modal.ejs` | Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Facebook App |
| `public/js/admin-settings-v2.js` | Logic JavaScript ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ App |
| `index.js` (lines 12560-12720) | API endpoints ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Facebook Apps |

### 3.2 API Endpoints

```
POST   /api/facebook-apps           - ‡∏™‡∏£‡πâ‡∏≤‡∏á Facebook App ‡πÉ‡∏´‡∏°‡πà
GET    /api/facebook-apps           - ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Apps ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
GET    /api/facebook-apps/:id       - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• App ‡∏ï‡∏≤‡∏° ID
PUT    /api/facebook-apps/:id       - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï App
DELETE /api/facebook-apps/:id       - ‡∏•‡∏ö App
```

### 3.3 ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å

| Field | Required | Description |
|-------|----------|-------------|
| `name` | ‚úÖ | ‡∏ä‡∏∑‡πà‡∏≠ App ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| `appId` | ‚úÖ | Facebook App ID ‡∏à‡∏≤‡∏Å Developer Console |
| `appSecret` | ‚ùå | App Secret (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö feature ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á) |
| `verifyToken` | Auto | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ |
| `webhookUrl` | Auto | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å |

### 3.4 Flow ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á App

```javascript
// ‡πÑ‡∏ü‡∏•‡πå: index.js (line 12561)
app.post("/api/facebook-apps", async (req, res) => {
    // 1. Validate input
    // 2. Generate verifyToken
    // 3. Insert to database
    // 4. Generate webhookUrl: `${baseUrl}/webhook/fb/${id}`
    // 5. Update webhookUrl in database
    // 6. Return response
});
```

### 3.5 ‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-------|-----------|------------|
| **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Validate App ID Format** | üü° Medium | ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ appId ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å Facebook |
| **App Secret ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™** | üî¥ High | ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• |
| **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå** | üü° Medium | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á App ‡∏à‡∏£‡∏¥‡∏á |

---

## 4. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Facebook Page (Bot)

### 4.1 ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

| ‡πÑ‡∏ü‡∏•‡πå | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà |
|------|--------|
| `views/partials/modals/facebook-bot-modal.ejs` | Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Facebook Page |
| `public/js/admin-settings-v2.js` | Logic JavaScript |
| `index.js` (lines 12087-12332) | API endpoints ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Facebook Bots |

### 4.2 API Endpoints

```
POST   /api/facebook-bots                      - ‡∏™‡∏£‡πâ‡∏≤‡∏á Facebook Bot ‡πÉ‡∏´‡∏°‡πà
GET    /api/facebook-bots                      - ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Bots ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
GET    /api/facebook-bots/:id                  - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Bot ‡∏ï‡∏≤‡∏° ID
PUT    /api/facebook-bots/:id                  - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Bot
DELETE /api/facebook-bots/:id                  - ‡∏•‡∏ö Bot
PATCH  /api/facebook-bots/:id/toggle-status    - ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
POST   /api/facebook-bots/:id/test             - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
```

### 4.3 ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å

| Field | Required | Description |
|-------|----------|-------------|
| `name` | ‚úÖ | ‡∏ä‡∏∑‡πà‡∏≠ Bot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö |
| `facebookAppId` | ‚úÖ | ID ‡∏Ç‡∏≠‡∏á Facebook App ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ |
| `pageId` | ‚úÖ | Facebook Page ID |
| `accessToken` | ‚úÖ | Page Access Token |
| `aiModel` | ‚úÖ | ‡πÇ‡∏°‡πÄ‡∏î‡∏• AI ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (default: gpt-5) |
| `datasetId` | ‚ùå | Dataset ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Conversions API |
| `description` | ‚ùå | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
| `isDefault` | ‚ùå | ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Bot ‡∏´‡∏•‡∏±‡∏Å |

### 4.4 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Bot ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

```javascript
{
    _id: ObjectId,
    name: "Page Name",
    description: "",
    pageId: "123456789",
    accessToken: "EAABwzLixnjYBO...",
    facebookAppId: ObjectId,
    status: "active" | "inactive",
    isDefault: false,
    aiModel: "gpt-5",
    aiConfig: {
        apiMode: "responses" | "chat",
        reasoningEffort: "low" | "medium" | "high",
        temperature: null,
        topP: null,
        presencePenalty: null,
        frequencyPenalty: null
    },
    selectedInstructions: [],
    selectedImageCollections: [],
    openaiApiKeyId: null,
    datasetId: null,
    keywordSettings: {
        enableAI: { keyword: "", response: "" },
        disableAI: { keyword: "", response: "" },
        disableFollowUp: { keyword: "", response: "" }
    },
    createdAt: Date,
    updatedAt: Date
}
```

### 4.5 ‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-------|-----------|------------|
| **Access Token ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™** | üî¥ High | Page Access Token ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏ö‡∏ö plain text ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• |
| **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Validate Token** | üü° Medium | ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á Access Token ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å |
| **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö Token Refresh** | üü° Medium | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö refresh token ‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ |
| **Duplicate PageId Check ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ App ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô** | üü° Medium | ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ PageId ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô App ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡∏ö‡∏™‡∏ô |

---

## 5. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Webhook)

### 5.1 Webhook Endpoints

| Endpoint | Description |
|----------|-------------|
| `GET /webhook/fb/:appId` | Verify webhook ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Facebook App |
| `POST /webhook/fb/:appId` | ‡∏£‡∏±‡∏ö event ‡∏à‡∏≤‡∏Å Facebook (Shared webhook) |
| `GET /webhook/facebook/:botId` | Verify webhook (Legacy per-bot) |
| `POST /webhook/facebook/:botId` | ‡∏£‡∏±‡∏ö event (Legacy per-bot) |

### 5.2 Flow ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Shared Webhook)

```javascript
// ‡πÑ‡∏ü‡∏•‡πå: index.js (lines 10023-10277)
app.post("/webhook/fb/:appId", async (req, res) => {
    // 1. ‡∏´‡∏≤ App ‡∏à‡∏≤‡∏Å appId
    const facebookApp = await appsColl.findOne({ _id: new ObjectId(appId) });
    
    // 2. ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (200 OK) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á Facebook retry
    res.status(200).json({ status: "EVENT_RECEIVED" });
    
    // 3. ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• Async
    if (req.body.object === "page") {
        for (let entry of req.body.entry) {
            // 4. ‡∏´‡∏≤ Bot ‡∏à‡∏≤‡∏Å pageId
            const facebookBot = await botsColl.findOne({
                facebookAppId: new ObjectId(appId),
                pageId: entryPageId,
                status: "active"
            });
            
            // 5. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ messaging events
            if (entry.messaging) {
                for (let messagingEvent of entry.messaging) {
                    // 5.1 ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Echo (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏û‡∏à)
                    if (messagingEvent.message?.is_echo) {
                        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≤‡∏°
                    }
                    
                    // 5.2 ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                    if (messagingEvent.message || messagingEvent.postback) {
                        await addToQueue(senderId, chatDoc, queueOptions);
                    }
                }
            }
            
            // 6. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ feed/comment events
            if (entry.changes) {
                // handleFacebookComment()
            }
        }
    }
});
```

### 5.3 ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

```javascript
// ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Facebook Graph API
const userProfileRes = await axios.get(
    `https://graph.facebook.com/v18.0/${senderId}`,
    {
        params: {
            fields: "first_name,last_name,profile_pic",
            access_token: accessToken,
        },
    }
);
```

### 5.4 ‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-------|-----------|------------|
| **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Verify Signature** | üî¥ High | ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö X-Hub-Signature ‡∏à‡∏≤‡∏Å Facebook |
| **Error Handling ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ñ‡∏π‡∏Å‡∏Å‡∏•‡∏∑‡∏ô** | üü° Medium | ‡∏ö‡∏≤‡∏á catch block ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ log error ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| **Profile API ‡∏≠‡∏≤‡∏à‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß** | üü¢ Low | ‡∏´‡∏≤‡∏Å‡∏î‡∏∂‡∏á profile ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ default ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô |
| **‡πÑ‡∏°‡πà‡∏°‡∏µ Rate Limiting** | üü° Medium | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î request ‡∏ï‡πà‡∏≠ user ‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |

---

## 6. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• AI ‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö

### 6.1 Message Queue System

```javascript
// ‡πÑ‡∏ü‡∏•‡πå: index.js (lines 5233-5341)

// ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Queue
userQueues[queueKey] = {
    userId: string,
    messages: [],
    timer: null,
    context: {} // botType, platform, aiModel, etc.
};

// ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Queue
async function addToQueue(userId, incomingItem, options = {}) {
    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á queue ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö maxQueueMessages (default: 10)
    // 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ queue
    // 4. ‡∏ï‡∏±‡πâ‡∏á timer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö chatDelaySeconds (default: 5)
    // 5. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ ‚Üí flushQueue()
}

// ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• Queue
async function flushQueue(queueKey) {
    // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å processFlushedMessages()
}
```

### 6.2 AI Processing Flow

```javascript
// ‡πÑ‡∏ü‡∏•‡πå: index.js (lines 5343-5638)
async function processFlushedMessages(userId, mergedContent, queueContext = {}) {
    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö system mode (maintenance?)
    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö user AI status
    // 3. ‡∏î‡∏∂‡∏á AI history
    // 4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö system AI enabled
    // 5. ‡πÉ‡∏ä‡πâ Recovery Strategies:
    //    - original: ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    //    - drop_invalid_images: ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
    //    - recent_text_only: ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    // 6. ‡∏™‡∏£‡πâ‡∏≤‡∏á system instructions
    // 7. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å AI:
    //    - getAssistantResponseMultimodal() (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ)
    //    - getAssistantResponseTextOnly() (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ)
    // 8. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å chat history
    // 9. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
}
```

### 6.3 AI Response Functions

```javascript
// Text Only (lines 8010-8216)
async function getAssistantResponseTextOnly(
    systemInstructions,
    history,
    userText,
    aiModel = null,
    botId = null,
    platform = null
) {
    // 1. ‡∏î‡∏∂‡∏á API Key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Bot
    // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á messages array
    // 3. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Tools (get_categories, search_item_by_category, search_item_broad)
    // 4. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å API Mode:
    //    - "chat": ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ tools
    //    - "responses": ‡πÉ‡∏ä‡πâ tools ‡∏û‡∏£‡πâ‡∏≠‡∏° tool loop (max 5 loops)
    // 5. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å OpenAI API
    // 6. Log token usage
    // 7. Return response
}

// Multimodal (lines 8219-8380)
async function getAssistantResponseMultimodal(
    systemInstructions,
    history,
    contentSequence,
    aiModel = null,
    botId = null,
    platform = null
) {
    // 1. ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ (maxImagesPerMessage, default: 3)
    // 2. ‡∏õ‡∏£‡∏±‡∏ö detail ‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ (low/high)
    // 3. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å OpenAI API ‡∏î‡πâ‡∏ß‡∏¢ vision model
    // 4. Log token usage
    // 5. Return response
}
```

### 6.4 AI Models ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö

| Model | Description |
|-------|-------------|
| `gpt-5.1` | ‡∏£‡∏∏‡πà‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î |
| `gpt-5` | ‡∏£‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô |
| `gpt-5-mini` | ‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏•‡πá‡∏Å ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ |
| `gpt-5-nano` | ‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î |
| `gpt-5-pro` | ‡∏£‡∏∏‡πà‡∏ô Pro |
| `gpt-4.1` | ‡∏£‡∏∏‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ |
| `gpt-4.1-mini` | ‡∏£‡∏∏‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏•‡πá‡∏Å) |
| `gpt-4o` | GPT-4 Omni |
| `gpt-4o-mini` | GPT-4 Omni (‡πÄ‡∏•‡πá‡∏Å) |

### 6.5 ‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-------|-----------|------------|
| **Tool Loop ‡∏≠‡∏≤‡∏à Infinite** | üü° Medium | ‡∏°‡∏µ MAX_TOOL_LOOPS = 5 ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ timeout |
| **‡πÑ‡∏°‡πà‡∏°‡∏µ Fallback ‡πÄ‡∏°‡∏∑‡πà‡∏≠ API ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß** | üü° Medium | ‡∏ñ‡πâ‡∏≤ OpenAI API ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏à‡∏∞ return string ‡∏ß‡πà‡∏≤‡∏á |
| **Token Limit ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö** | üü° Medium | ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î context ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á API |
| **History ‡πÑ‡∏°‡πà‡∏°‡∏µ Rolling Window** | üü¢ Low | ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ token ‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏ñ‡πâ‡∏≤ history ‡∏¢‡∏≤‡∏ß |
| **Image Base64 Size** | üü° Medium | ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ compress ‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ token ‡∏°‡∏≤‡∏Å |

---

## 7. ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤

### 7.1 sendFacebookMessage Function

```javascript
// ‡πÑ‡∏ü‡∏•‡πå: index.js (lines 10678-10851)
async function sendFacebookMessage(
    recipientId,
    message,
    accessToken,
    options = {},
    customAssetsMap = null
) {
    // 1. ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ [cut]
    const parts = String(message).split("[cut]");
    
    // 2. Parse #[IMAGE:<label>] tokens
    for (const part of parts) {
        const segments = parseMessageSegmentsByImageTokens(part, assetsMap);
        
        for (const seg of segments) {
            if (seg.type === "text") {
                // 3. Chunk text to maxLength (2000)
                // 4. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡∏•‡∏∞ chunk
                await axios.post(
                    `https://graph.facebook.com/v18.0/me/messages`,
                    { recipient: { id: recipientId }, message: { text: chunk } },
                    { params: { access_token: accessToken } }
                );
            } else if (seg.type === "image") {
                // 5. ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (upload ‡∏´‡∏£‡∏∑‡∏≠ url mode)
                // 6. Fallback ‡∏ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
            }
        }
    }
}
```

### 7.2 Image Send Modes

| Mode | Description |
|------|-------------|
| `upload` | ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏õ Facebook ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥) |
| `url` | ‡∏™‡πà‡∏á URL ‡πÉ‡∏´‡πâ Facebook ‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ |

### 7.3 Message Metadata

| Metadata | Description |
|----------|-------------|
| `ai_generated` | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å AI |
| `follow_up_auto` | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Follow-up ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ |
| `broadcast_auto` | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Broadcast |

### 7.4 Admin Chat Send

```javascript
// Frontend: public/js/chat-redesign.js (lines 979-1052)
async sendMessage() {
    // 1. Optimistic UI: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
    const response = await fetch('/admin/chat/send', {
        method: 'POST',
        body: JSON.stringify({ userId, message })
    });
    // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏´‡∏£‡∏∑‡∏≠ rollback ‡∏ñ‡πâ‡∏≤ error
}
```

### 7.5 ‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|-------|-----------|------------|
| **Text Chunk ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Word Boundary** | üü¢ Low | ‡∏≠‡∏≤‡∏à‡∏ï‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠ chunk text |
| **Image Fallback ‡πÅ‡∏™‡∏î‡∏á Error ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ** | üü¢ Low | `[‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ...]` ‡∏≠‡∏≤‡∏à‡∏î‡∏π‡πÑ‡∏°‡πà‡∏î‡∏µ |
| **‡πÑ‡∏°‡πà‡∏°‡∏µ Retry Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Rate Limit** | üü° Medium | ‡∏ñ‡πâ‡∏≤‡πÇ‡∏î‡∏ô rate limit ‡∏à‡∏∞ fail ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ |
| **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Queue ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≤‡∏≠‡∏≠‡∏Å** | üü° Medium | ‡∏≠‡∏≤‡∏à‡πÇ‡∏î‡∏ô rate limit ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô |

---

## 8. ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î

### 8.1 ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Security Issues)

| # | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡πÑ‡∏ü‡∏•‡πå | ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î |
|---|-------|-----------|------|--------|
| S1 | **Access Token ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™** | üî¥ High | index.js | 12142-12163 |
| S2 | **App Secret ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™** | üî¥ High | index.js | 12560+ |
| S3 | **‡πÑ‡∏°‡πà‡∏°‡∏µ Webhook Signature Verification** | üî¥ High | index.js | 10024 |
| S4 | **API Keys ‡πÄ‡∏Å‡πá‡∏ö plain text** | üî¥ High | ‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö | - |
| S5 | **‡πÑ‡∏°‡πà‡∏°‡∏µ Rate Limiting ‡∏ó‡∏µ‡πà Webhook** | üü° Medium | index.js | 10024 |

### 8.2 ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (Performance Issues)

| # | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡πÑ‡∏ü‡∏•‡πå | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|---|-------|-----------|------|------------|
| P1 | **‡πÑ‡∏°‡πà‡∏°‡∏µ Connection Pooling ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô** | üü° Medium | index.js | MongoDB connections |
| P2 | **‡πÑ‡∏°‡πà‡∏°‡∏µ Caching ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Settings** | üü° Medium | index.js | getSettingValue() ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á |
| P3 | **Image Base64 ‡πÑ‡∏°‡πà Compress** | üü° Medium | index.js | Multimodal processing |
| P4 | **Tool Loop ‡πÑ‡∏°‡πà‡∏°‡∏µ Timeout** | üü° Medium | index.js | 8107-8160 |

### 8.3 ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Functional Issues)

| # | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡πÑ‡∏ü‡∏•‡πå | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|---|-------|-----------|------|------------|
| F1 | **Token Refresh ‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥** | üü° Medium | - | Page Access Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ |
| F2 | **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Validate Token ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å** | üü° Medium | index.js | 12088+ |
| F3 | **Error Message ‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô** | üü¢ Low | ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå | Generic error messages |
| F4 | **‡πÑ‡∏°‡πà‡∏°‡∏µ Health Check Route** | üü¢ Low | index.js | ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö monitoring |

### 8.4 ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô User Experience

| # | ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡πÑ‡∏ü‡∏•‡πå | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|---|-------|-----------|------|------------|
| U1 | **‡πÑ‡∏°‡πà‡∏°‡∏µ Loading State ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô** | üü¢ Low | admin-settings-v2.js | ‡∏ö‡∏≤‡∏á UI ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á spinner |
| U2 | **Success Toast ‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á** | üü¢ Low | admin-settings-v2.js | Timing issues |
| U3 | **Form Validation ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô** | üü° Medium | modals/*.ejs | HTML validation ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô |

---

## 9. ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á

### 9.1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Priority: High)

```javascript
// 1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ Access Token
const crypto = require('crypto');

function encryptToken(token) {
    const cipher = crypto.createCipheriv('aes-256-gcm', secretKey, iv);
    // ...
}

// 2. Verify Facebook Webhook Signature
function verifyFacebookSignature(req, appSecret) {
    const signature = req.headers['x-hub-signature-256'];
    const expectedSignature = crypto
        .createHmac('sha256', appSecret)
        .update(JSON.stringify(req.body))
        .digest('hex');
    return signature === `sha256=${expectedSignature}`;
}
```

### 9.2 ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û

```javascript
// 1. Cache Settings
const settingsCache = new Map();
const CACHE_TTL = 60000; // 1 minute

async function getSettingValueCached(key, defaultValue) {
    const cached = settingsCache.get(key);
    if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
        return cached.value;
    }
    const value = await getSettingValue(key, defaultValue);
    settingsCache.set(key, { value, timestamp: Date.now() });
    return value;
}

// 2. Compress Images
const sharp = require('sharp');

async function compressImage(base64) {
    const buffer = Buffer.from(base64, 'base64');
    const compressed = await sharp(buffer)
        .resize(1024, 1024, { fit: 'inside' })
        .jpeg({ quality: 80 })
        .toBuffer();
    return compressed.toString('base64');
}
```

### 9.3 Error Handling

```javascript
// 1. Custom Error Classes
class FacebookAPIError extends Error {
    constructor(message, code, subcode) {
        super(message);
        this.code = code;
        this.subcode = subcode;
    }
}

// 2. Retry Logic with Exponential Backoff
async function sendWithRetry(fn, maxRetries = 3) {
    for (let i = 0; i < maxRetries; i++) {
        try {
            return await fn();
        } catch (error) {
            if (i === maxRetries - 1) throw error;
            await sleep(Math.pow(2, i) * 1000);
        }
    }
}
```

### 9.4 Monitoring & Logging

```javascript
// 1. Add Health Check
app.get('/health', (req, res) => {
    res.json({
        status: 'ok',
        timestamp: new Date().toISOString(),
        uptime: process.uptime()
    });
});

// 2. Structured Logging
const logger = {
    info: (msg, meta) => console.log(JSON.stringify({ level: 'info', msg, ...meta, timestamp: new Date().toISOString() })),
    error: (msg, meta) => console.error(JSON.stringify({ level: 'error', msg, ...meta, timestamp: new Date().toISOString() }))
};
```

---

## 10. ‡∏™‡∏£‡∏∏‡∏õ

### 10.1 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°

| ‡∏´‡∏°‡∏ß‡∏î | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô |
|------|-------|-------|
| ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á Feature | ‚úÖ ‡∏î‡∏µ | 8/10 |
| ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ | ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á | 5/10 |
| ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û | ‚ö†Ô∏è ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á | 6/10 |
| Code Quality | ‚úÖ ‡∏î‡∏µ | 7/10 |
| Error Handling | ‚ö†Ô∏è ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á | 6/10 |
| Documentation | ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á | 5/10 |

### 10.2 ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á

| ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô |
|-----------|--------|
| üî¥ High | 4 |
| üü° Medium | 14 |
| üü¢ Low | 7 |

### 10.3 Action Items ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

1. **‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (This Sprint)**
   - [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Webhook Signature Verification
   - [ ] ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ Access Token ‡πÅ‡∏•‡∏∞ App Secret ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

2. **‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô (Next Sprint)**
   - [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Token Validation ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
   - [ ] ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Error Handling
   - [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Rate Limiting

3. **‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏•‡∏≤‡∏á (Next Month)**
   - [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Settings Cache
   - [ ] ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Image Compression
   - [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Health Check Endpoint
   - [ ] ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Unit Tests

---

**‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢:** AI System Review  
**‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** 10 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2567
